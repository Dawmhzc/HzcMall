<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>懒人电商</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/x-icon" href="../../static/assets/images/favicon.png"/>
    <link rel="stylesheet" href="../../static/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../static/assets/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../static/assets/css/owl.carousel.min.css">
    <link rel="stylesheet" href="../../static/assets/css/animate.min.css">
    <link rel="stylesheet" href="../../static/assets/css/jquery-ui.css">
    <link rel="stylesheet" href="../../static/assets/css/slick.css">
    <link rel="stylesheet" href="../../static/assets/css/chosen.min.css">
    <link rel="stylesheet" href="../../static/assets/css/pe-icon-7-stroke.css">
    <link rel="stylesheet" href="../../static/assets/css/magnific-popup.min.css">
    <link rel="stylesheet" href="../../static/assets/css/lightbox.min.css">
    <link rel="stylesheet" href="../../static/assets/js/fancybox/source/jquery.fancybox.css">
    <link rel="stylesheet" href="../../static/assets/css/jquery.scrollbar.min.css">
    <link rel="stylesheet" href="../../static/assets/css/mobile-menu.css">
    <link rel="stylesheet" href="../../static/assets/fonts/flaticon/flaticon.css">
    <link rel="stylesheet" href="../../static/assets/css/style1.css">
    <link rel="stylesheet" href="../../static/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../static/assets/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../static/assets/css/owl.carousel.min.css">
    <link rel="stylesheet" href="../../static/assets/css/animate.min.css">
    <link rel="stylesheet" href="../../static/assets/css/jquery-ui.css">
    <link rel="stylesheet" href="../../static/assets/css/slick.css">
    <link rel="stylesheet" href="../../static/assets/css/chosen.min.css">
    <link rel="stylesheet" href="../../static/assets/css/pe-icon-7-stroke.css">
    <link rel="stylesheet" href="../../static/assets/css/magnific-popup.min.css">
    <link rel="stylesheet" href="../../static/assets/css/lightbox.min.css">
    <link rel="stylesheet" href="../../static/assets/js/fancybox/source/jquery.fancybox.css">
    <link rel="stylesheet" href="../../static/assets/css/jquery.scrollbar.min.css">
    <link rel="stylesheet" href="../../static/assets/css/mobile-menu.css">
    <link rel="stylesheet" href="../../static/assets/fonts/flaticon/flaticon.css">
    <link rel="stylesheet" href="../../static/assets/css/style1.css">
</head>
<body class="inblog-page">
<header class="header style7">
    <div class="top-bar">
        <div class="container">
            <div class="top-bar-left">
                <div class="header-message">
                    欢迎来到懒人商城!
                </div>
            </div>
            <div class="top-bar-right">
                <ul class="header-user-links">
                    <li th:if="${session.userId} eq null">
                        <a th:href="@{/login}">Login or Register</a>
                    </li>
                    <li th:if="${session.userId} ne null">
                        <a th:href="@{/user/exit}" th:text="${session.username}">Login or Register</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="main-header">
            <div class="row">
                <div class="col-lg-3 col-sm-4 col-md-3 col-xs-7 col-ts-12 header-element">
                    <div class="logo">
                        <img src="../../static/assets/images/logo.png" alt="img">
                    </div>
                </div>
                <div class="col-lg-7 col-sm-8 col-md-6 col-xs-5 col-ts-12">
                    <div class="block-search-block">
                        <form class="form-search form-search-width-category">
                            <div class="form-content">
                                <div class="inner">
                                    <input type="text" class="input" name="s" value="">
                                </div>
                                <button class="btn-search" type="submit">
                                    <span class="icon-search"></span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="header-nav-container">
        <div class="container">
            <div class="header-nav-wapper main-menu-wapper">
                <div class="vertical-wapper block-nav-categori">
                    <div class="block-title">
						<span class="icon-bar">
							<span></span>
							<span></span>
							<span></span>
						</span>
                        <span class="text">All Categories</span>
                    </div>
                </div>
                <!--菜单栏-->
                <div class="header-nav">
                    <div class="container-wapper">
                        <ul class="dungar-clone-mobile-menu dungar-nav main-menu " id="menu-main-menu">
                            <li class="menu-item  menu-item-has-children">
                                <a th:href="@{/}" class="dungar-menu-item-title" title="Home">  首页  </a>
                            </li>
                            <li class="menu-item menu-item-has-children">
                                <a th:href="@{/goods/getGoodsList}" class="dungar-menu-item-title" title="Shop">  商品  </a>
                            </li>
                            <li class="menu-item menu-item-has-children">
                                <a th:href="@{/shopCart/showShopCartList/}" class="dungar-menu-item-title" title="Pages">  购物车  </a>
                            </li>
                            <li class="menu-item menu-item-has-children">
                                <a th:href="@{/order/getall}" class="dungar-menu-item-title" title="Pages">  订单  </a>
                            </li>
                            <li class="menu-item menu-item-has-children">
                                <a th:href="@{/address/all}" class="dungar-menu-item-title" title="Pages">  收货地址  </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
<div class="site-content">
    <main class="site-main  main-container no-sidebar">
        <div class="container">
            <div class="breadcrumb-trail breadcrumbs">
                <ul class="trail-items breadcrumb">
                </ul>
            </div>
            <div class="row">
                <div class="main-content-cart main-content col-sm-12">
                    <h3 class="custom_blog_title">
                        你的购物车
                    </h3>
                    <div class="page-main-content">
                        <div class="shoppingcart-content">
                            <form action="" class="cart-form">
                                <table class="shop_table" id="shopCart_table">
                                    <thead>
                                    <tr>
                                        <th>选择</th>
                                        <th class="product-name">商品名字</th>
                                        <th class="product-subtotal">价格</th>
                                        <th class="product-quantity">数量</th>
                                        <th class="product-addtocart">action</th>
                                    </thead>
                                    <tbody>
                                    <tr class="cart_item" th:each="item:${shopCartList}">
                                        <td>
                                            <input type="checkbox" th:value="${item.get('shopCartId')}">
                                        </td>
                                        <td class="product-name" data-title="Product">
                                            <a th:text="${item.get('goodsName')}" th:href="@{/shopCart/getDetailMallGoods/{goodsId}(goodsId=${item.get('goodsId')})}" class="title">Mini swing dress</a>
                                            <span th:text="${item.get('goodsId')}">Black,</span>
                                        </td>
                                        <td class="product-price" data-title="Price">
                                            <span class="woocommerce-Price-amount amount">
                                                <span th:text="'$'+${item.get('sellingPrice')}" class="woocommerce-Price-currencySymbol">$</span>
                                            </span>
                                        </td>
                                        <td class="product-quantity" data-title="Quantity">
                                            <div class="quantity">
                                                <div class="control">
                                                    <a class="btn-number qtyminus quantity-minus">-</a>
                                                    <input th:value="${item.get('goodsCount')}" type="text" data-step="1" data-min="0" value="1" title="Qty"
                                                           class="input-qty qty" size="4" id="example-number-input">
                                                    <a class="btn-number qtyplus quantity-plus">+</a>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="product-addtocart" data-title="Price">
                                            <button class="button editNum" type="button"> 编辑数量 </button>
                                            <a th:href="@{/shopCart/getSurge/{goodsId}(goodsId=${item.get('goodsId')})}" th:target="_blank" class="button"> 查看价格波动 </a>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </form>
                            <div class="control-cart">
                                <button id="del_s" class="button">删除选中的商品</button>
                                <button id="gopay" class="button btn-cart-to-checkout">购买</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>
<footer class="footer style7">
    <div class="container">
        <div class="container-wapper">
            <div class="row">
                <div class="box-footer col-xs-12 col-sm-4 col-md-4 col-lg-4 hidden-sm hidden-md hidden-lg">
                    <div class="dungar-newsletter style1">
                        <div class="newsletter-head">
                            <h3 class="title">开发人员</h3>
                        </div>
                        <div class="newsletter-form-wrap">
                            <div class="list">
                                黄智超 吴少波 李黄斌 <br/> 苏振锋 张腾辉 李超凡
                            </div>
                        </div>
                    </div>
                </div>
                <div class="box-footer col-xs-12 col-sm-4 col-md-4 col-lg-4">
                    <div class="dungar-custommenu default">
                        <h2 class="widgettitle"></h2>
                        <ul class="menu">
                            <li class="menu-item"></li>
                            <li class="menu-item"></li>
                        </ul>
                    </div>
                </div>
                <div class="box-footer col-xs-12 col-sm-4 col-md-4 col-lg-4 hidden-xs">
                    <div class="dungar-newsletter style1">
                        <div class="newsletter-head">
                            <h3 class="title">联系我们</h3>
                        </div>
                        <div class="newsletter-form-wrap">
                            <div class="list">
                                电话:19959739899 <br/> 邮箱:904096333@qq.com
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</footer>

<div th:replace="mall/commons :: commons_js"></div>
<script>
    $(".button.editNum").click(function (){
        let shopCartId=$(this).parents("tr").find("input:checkbox").val();
        let goodsCount=$(this).parents("tr").find("#example-number-input").val();
        console.log(shopCartId+":"+goodsCount);
        $.ajax({
            url: "/shopCart/editShopCart",
            type: "POST",
            data: {"shopCartId": shopCartId,"goodsCount": goodsCount},
            dataType: "json",
            success: function (data){
                alert(data.message);
            },
            error: function (xhr) {
                alert(xhr.message);
            }
        });
    });
    //$(".mdi.mdi-close-circle-outline.font-20").parent().children("input:checkbox");
    $("#del_s").click(function (){
        let ids=[];
        let chkBoxes=$("#shopCart_table").find("input:checkbox:checked");
        $(chkBoxes).each(function (){
            let id=$(this).attr("value");
            ids.push(id);
        });
        console.log(ids);
        $.ajax({
            url: "/shopCart/delShopCart",
            type: "POST",
            data: {"ids": ids},
            dataType: "json",
            success: function (data){
                alert(data.message);
            },
            error: function (xhr) {
                alert(xhr.message);
            }
        });
    });
    $("#gopay").click(function (){
        let chkBoxes=$("#shopCart_table").find("input:checkbox:checked");
        if (chkBoxes.length<1) {
            alert("你没有选择商品");
            console.log("你没有选择商品");
        }
        else if (chkBoxes.length>1) {
            alert("一次支付只能选择一种商品");
            console.log("一次支付只能选择一种商品");
        }
        else {
            let id=$(chkBoxes[0]).attr("value");
            window.location.href="/shopCart/goCheckout/"+id;
        }
    });
    $("#flush_total").click(function (){
        let ids=[];
        let chkBoxes=$("#shopCart_table").find("input:checkbox:checked");
        $(chkBoxes).each(function (){
            let id=$(this).attr("value");
            ids.push(id);
        });
        $.ajax({
            url: "/shopCart/getTatal",
            type: "POST",
            data: {"ids": ids},
            dataType: "json",
            success: function (data){
                $(".total-price").text('$'+data.data);
            }
        });
    });
</script>
</body>
</html>